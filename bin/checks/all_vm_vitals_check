#!/usr/bin/env ruby

require 'pp'
require 'bosh_vitals'

con = BoshVitals::Bosh::Connection.new
con.login

fet = BoshVitals::Bosh::VitalFetcher.new con
fet.get_deployment_names
vitals_records = fet.fetch_vitals_record

checker = BoshVitals::Checkers::VmVitalsChecker.new
check_result = checker.check_all vitals_records[:vitals]

puts "*" * 20
puts 'Results:'
puts "*" * 20
puts "Warnings:"
pp checker.warnings.inspect
puts "*" * 20
puts "Alerts:"
pp checker.alerts.inspect
puts "*" * 20

exit 0 if check_result
exit -1
